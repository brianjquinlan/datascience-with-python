{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        
        <title> {% block title %} ML with Python {% endblock %} </title>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="blog/information site on machine learning">
        <meta name="author" content="Brian Quinlan">
        
        {% block css %}
        	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

			<!-- third party css -->

			<!-- site specific css -->
			<link href="{% static 'css/style.css' %}" rel="stylesheet">
            <link href="{% static 'css/hilite.css' %}" rel="stylesheet">
		{% endblock %}

		{% block scripts %}
		{% endblock %}
    </head>
    <body>

		{% block nav %}
            <nav class="navbar navbar-toggleable-sm">
    			<button class="navbar-toggler navbar-toggler-right"
					type="button" data-toggle="collapse" data-target="#navbar">
        				<span class="navbar-toggler-icon"> &#9776; </span>
    			</button>
    			
				<a class="navbar-brand" href="{% url 'home' %}">DataScience with Python</a>
    			<div class="navbar-collapse collapse justify-content-end" id="navbar">
        			<ul class="navbar-nav float-sm-right">
						<li class="nav-item">
						    <a class="nav-link" href="{% url 'home' %}"> Home</a>
						</li>
						<li class="nav-item">
						    <a class="nav-link" href="#"> About </a>
						</li>
						<li class="nav-item">
						    <a class="nav-link" href="{% url 'blog:post_list' %}"> Blog </a>
						</li>
        			</ul>
  			  </div>
			</nav>
		{% endblock %}

		{% if messages %}
			{% for message in messages %}
				<div class="alert {% if message.tags %} alert-{{ message.tags }}{% endif %}">
					{{ message }}
				</div>
			{% endfor %}
		{% endif %}
        
        <div id="content">
		    {% block content %}
			    <p> content </p>
		    {% endblock content	%}			
        </div>

        {% block sidebar %}
            <div id="sidebar">
                <h2> Machine Learning with Python </h3>
                    <p> Posts about small machine learning projects </p>
                
                <h4> Blog Archives </h4>
                    <a href={% url 'blog:archive_list' %}> Archived Posts </a>
                
                <br />
                <br />
                <div class="subscribe-form">
                    <h4> Subscribe to blog posts by email </h4>
                    <form id="subscribe" method="POST" action=".">
                        {% csrf_token %}
                        <input id="email_id" type="email" name="email_id" placeholder="your@email.com">
                        <button type="submit" value="Subscribe" id="email_submit"> Subscribe </button>
                    </form>
                </div>
                
                <br />
                <h4> Subscribe via rss </h4>
                    <a href="{% url 'blog:feed' %}"> Rss </a>
            </div>
            
        {% endblock %}

		{% block footer %}
		{% endblock %}

	 	{% block javascript %}
			<!-- jQuery -->
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
			<!-- requirement for bootstrap -->
     	 	<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.2.0/js/tether.min.js"></script>
			
			<!-- Javascript -->
			<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

			<!-- third-party javascript -->

			<!-- project javascript -->
			<script src="{% static 'js/project.js' %}"></script>
		    
            <!-- js-plugin to get csrftoken  -->
            <script src="{% static 'js/js.cookie.js' %}"></script>

            <script>
                (function() {
                    var csrftoken = Cookies.get('csrftoken');
                    function csrfSafeMethod(method) {
                        // these HTTP methods do not requre CSRF protection
                        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                    }
                    $.ajaxSetup({
                        beforeSend: function(xhr, settings) {
                            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                                xhr.setRequestHeader("X-CSRFToken", csrftoken);
                            }
                        }
                    });
                })();

                $(document).ready(function(){
                    $('#subscribe').submit(function(e) {
                        e.preventDefault();
                        var email_id = $('#email_id').val();

                        if (email_id) {
                            var csrfmiddlewaretoken = csrftoken;
                            var email_data = {'email_id': email_id,
                                'csrfmiddlewaretoken': csrfmiddlewaretoken };
                            
                            $.ajax({
                                type: 'POST',
                                url: '/blog/subscribe/',
                                data: email_data,
                                success: function(response) {
                                    $('#email_id').val('');
                                    alert("Thank you for subscribing Check your email to confirm.");
                                },
                                error: function(response) {
                                    alert("Something went wrong");
                                    $('#email_id').val('');
                                }
                            });
                            return false;
                        } else {
                            alert('Please provide correct email');
                        }
                    });

                    {% block domready %} 
                    {% endblock %}
                });
            </script>
            
        {% endblock %}
        
    </body>
</html>
